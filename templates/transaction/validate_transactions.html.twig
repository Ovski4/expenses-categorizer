{% extends 'base.html.twig' %}

{% block title %}Validate transactions{% endblock %}

{% block navbar %}
    {% include 'navbar.html.twig' with {'current': 'import_transaction'} %}
{% endblock %}

{% block body %}
    <h1>Validate transactions</h1>

    {% if transactions is defined %}

        <div class="alert alert-info" role="alert">
            {{ transactions|length }} transactions to import
            (total amount is {{ transactions|reduce((sum, transaction) => sum + transaction.amount, 0) }})
        </div>

        {% if existingTransactionCount > 0 %}
            <div class="alert alert-{{ existingTransactionCount == transactions|length ? 'danger' : 'warning' }}" role="alert">
                {{ existingTransactionCount }} of these transactions already exists!
                Are you sure you never imported this statement?
            </div>
        {% endif %}

        <form method="post" action="{{ path('validate_transactions', {'statement': statement, 'parserName': parserName }) }}">
            <input type="hidden" name="_method" value="POST">
            <button class="btn btn-primary">Save these transactions</button>
        </form>

        <table class="table">
            <thead class="thead-dark">
                <tr>
                    <th>Label</th>
                    <th>Amount</th>
                    <th>Created_at</th>
                    <th>Account</th>
                </tr>
            </thead>
            <tbody>
            {% for transaction in transactions %}
                <tr>
                    <td>{{ transaction.label | capitalize }}</td>
                    <td>{{ transaction.amount }}</td>
                    <td>{{ transaction.createdAt|date('Y-m-d') }}</td>
                    <td>{{ transaction.account }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

    {% else %}

        <div class="alert alert-danger" role="alert">
            {{ error }}
        </div>
        <div class="alert alert-info" role="alert">
            <a href="{{ path(suggestionPath, suggestionPathParams ?? []) }}">{{ suggestionLabel }}</a>
        </div>

    {% endif %}

{% endblock %}
