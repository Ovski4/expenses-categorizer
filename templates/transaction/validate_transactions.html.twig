{% extends 'base.html.twig' %}

{% block title %}Validate transactions{% endblock %}

{% block navbar %}
    {% include 'navbar.html.twig' with {'current': 'import_transaction'} %}
{% endblock %}

{% block body %}
    <h1>Validate transactions</h1>

    {% if transactions|length > 0 %}
        <div class="alert alert-info" role="alert">
            {{ transactions|length }} transactions to import
            (total amount is {{ transactions|reduce((sum, transaction) => sum + transaction.amount, 0) }})
        </div>
    {% else %}
        <div class="alert alert-danger" role="alert">
            No transactions were found. Are you sure your pdf is a valid statement file?
        </div>
        <div class="alert alert-info" role="alert">
            <a href="{{ path('transaction_upload_statement') }}">Go back to file upload</a>
        </div>
    {% endif %}

    {% if existingTransactionCount > 0 %}
        <div class="alert alert-{{ existingTransactionCount == transactions|length ? 'danger' : 'warning' }}" role="alert">
            {{ existingTransactionCount }} of these transactions already exists!
            Are you sure you never imported this statement?
        </div>
    {% endif %}

    {% if transactions|length > 0 %}
        <form method="post" action="{{ path('validate_transactions', {'statement': statement }) }}">
            <input type="hidden" name="_method" value="POST">
            <button class="btn btn-primary">Save these transactions</button>
        </form>

        <table class="table">
            <thead class="thead-dark">
                <tr>
                    <th>Label</th>
                    <th>Amount</th>
                    <th>Created_at</th>
                    <th>Account</th>
                </tr>
            </thead>
            <tbody>
            {% for transaction in transactions %}
                <tr>
                    <td>{{ transaction.label | capitalize }}</td>
                    <td>{{ transaction.amount }}</td>
                    <td>{{ transaction.createdAt|date('Y-m-d') }}</td>
                    <td>{{ transaction.account }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% endif %}

{% endblock %}
